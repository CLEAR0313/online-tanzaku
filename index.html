/*
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆï¼š

ğŸ“ tanzaku-app/
â”œâ”€â”€ server.js
â”œâ”€â”€ package.json
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html   â† æŠ•ç¨¿ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ hiroba.html   â† ä¸€è¦§è¡¨ç¤ºãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ style.css
â”‚   â”œâ”€â”€ post.js
â”‚   â””â”€â”€ hiroba.js
â””â”€â”€ data/
    â””â”€â”€ tanzaku.json
*/

// ==== package.json ====
{
  "name": "tanzaku-app",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "express": "^4.18.0",
    "body-parser": "^1.20.0"
  }
}

// ==== server.js ====
const express = require('express');
const bodyParser = require('body-parser');
const fs = require('fs');
const path = require('path');

const app = express();
const PORT = process.env.PORT || 3000;
const DB_PATH = path.join(__dirname, 'data', 'tanzaku.json');

app.use(bodyParser.json());
app.use(express.static('public'));

app.get('/api/tanzaku', (req, res) => {
  const data = fs.existsSync(DB_PATH) ? JSON.parse(fs.readFileSync(DB_PATH)) : [];
  res.json(data);
});

app.post('/api/tanzaku', (req, res) => {
  const { name, wish, color } = req.body;
  if (!name || !wish || !color) return res.status(400).json({ error: 'Invalid input' });
  const newEntry = { name, wish, color, date: new Date() };
  const data = fs.existsSync(DB_PATH) ? JSON.parse(fs.readFileSync(DB_PATH)) : [];
  data.unshift(newEntry);
  fs.writeFileSync(DB_PATH, JSON.stringify(data, null, 2));
  res.json({ success: true });
});

app.listen(PORT, () => console.log(`Server running at http://localhost:${PORT}`));

// ==== public/index.html ====
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>çŸ­å†Šã«é¡˜ã„ã‚’æ›¸ã</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ğŸ‹ çŸ­å†Šã«é¡˜ã„ã‚’è¾¼ã‚ã¦ ğŸ‹</h1>
  <div class="form">
    <label>ãŠåå‰ï¼š<input id="name" type="text"></label><br>
    <label>é¡˜ã„äº‹ï¼š<input id="wish" type="text"></label><br>
    <label>è‰²ã‚’é¸ã‚“ã§ã­ï¼š
      <select id="color">
        <option value="#f66">èµ¤</option>
        <option value="#6cf">é’</option>
        <option value="#fc6">é»„</option>
        <option value="#6f6">ç·‘</option>
        <option value="#c6f">ç´«</option>
      </select>
    </label><br>
    <button id="submit">çŸ­å†Šã‚’æŠ•ç¨¿ã™ã‚‹</button>
  </div>
  <script src="post.js"></script>
</body>
</html>

// ==== public/post.js ====
document.getElementById('submit').onclick = async () => {
  const name = document.getElementById('name').value.trim();
  const wish = document.getElementById('wish').value.trim();
  const color = document.getElementById('color').value;
  if (!name || !wish) return alert('åå‰ã¨é¡˜ã„äº‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
  await fetch('/api/tanzaku', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, wish, color })
  });
  window.location.href = '/hiroba.html';
};

// ==== public/hiroba.html ====
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã¿ã‚“ãªã®çŸ­å†Šåºƒå ´</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ğŸŒŸ ã¿ã‚“ãªã®é¡˜ã„ ğŸŒŸ</h1>
  <div id="list" class="grid"></div>
  <script src="hiroba.js"></script>
</body>
</html>

// ==== public/hiroba.js ====
fetch('/api/tanzaku')
  .then(res => res.json())
  .then(data => {
    const list = document.getElementById('list');
    data.forEach(t => {
      const div = document.createElement('div');
      div.className = 'tanzaku';
      div.style.background = t.color;
      div.innerHTML = `<strong>${t.name}</strong><br>${t.wish}`;
      list.appendChild(div);
    });
  });

// ==== public/style.css ====
body { font-family: sans-serif; text-align: center; background: #f9f9f9; }
input, select { margin: 5px; }
.tanzaku {
  width: 120px; padding: 10px; margin: 10px;
  color: #000; background: #eee; border-radius: 8px;
  display: inline-block; text-align: center;
  box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
}
.grid { display: flex; flex-wrap: wrap; justify-content: center; }
.form { margin: 30px auto; width: 300px; }

/* End of full app */
